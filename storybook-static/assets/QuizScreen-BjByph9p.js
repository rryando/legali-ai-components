import{j as s}from"./jsx-runtime-BjG_zV1W.js";import{r as e}from"./index-yIsmwZOr.js";import{c as W}from"./utils-CDN07tui.js";import{Q as ae}from"./QuizHeader-D4vIS8m-.js";import{Q as ue}from"./QuizQuestion-DEq9Peb5.js";import{Q as le}from"./QuizFeedback-CMksgjil.js";import{T as ce}from"./TypingText-j2PaxV7C.js";import{a as u,L as me}from"./LegaliMascot-YN_T4VAf.js";import{A as de}from"./Answer-Cm3wYL8a.js";import{B as pe}from"./button-CXZ-4DRD.js";const X=[{motion:u.SPEAKING,durationMs:3500,lines:["Quick tip:","Read for what the court needs: amount, venue, and timing."]},{motion:u.THINKING,durationMs:null,lines:["Pick the best answer.","If unsure, eliminate obvious mismatches."]}],V=e.forwardRef(({className:G,active:d=!0,script:v,interruptScript:M,triggerKey:T,inactiveMotion:k=u.IDLE,mascotWidth:S=140,mascotHeight:K=140,mascotBlink:l=!0,stream:i,onStepChange:R,onMotionChange:q,...N})=>{const D=e.useRef([]),I=e.useCallback(()=>{D.current.forEach(o=>clearTimeout(o)),D.current=[]},[]),[L,c]=e.useState(0),[B,p]=e.useState(k),y=e.useCallback((o,w)=>{c(o),p(w),R==null||R(o),q==null||q(w)},[q,R]),P=e.useCallback(o=>{if(I(),!o.length){y(0,k);return}y(0,o[0].motion);let w=0;for(let a=0;a<o.length-1;a++){const g=o[a].durationMs;if(g==null)break;w+=g;const x=o[a+1],C=window.setTimeout(()=>{y(a+1,x.motion)},w);D.current.push(C)}},[I,k,y]),h=e.useMemo(()=>v!=null&&v.length?v:X,[v]),b=e.useMemo(()=>M!=null&&M.length?M:void 0,[M]),A=e.useRef(T);e.useEffect(()=>{if(!d){I(),p(k);return}const o=A.current!==T;return A.current=T,P(o&&b?b:h),()=>{I()}},[d,T,h,b,k,P,I]);const m=h[L]??h[0]??X[0],E=e.useMemo(()=>typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(prefers-reduced-motion: reduce)").matches,[]),t=e.useMemo(()=>({charIntervalMs:(i==null?void 0:i.charIntervalMs)??28,linePauseMs:(i==null?void 0:i.linePauseMs)??5e3,loop:(i==null?void 0:i.loop)??!0,showCursor:(i==null?void 0:i.showCursor)??!1,fitToStepDuration:(i==null?void 0:i.fitToStepDuration)??!0}),[i]),j=e.useMemo(()=>((m==null?void 0:m.lines)??[]).map(o=>o==null?void 0:o.trim()).filter(Boolean),[m==null?void 0:m.lines]),U=e.useCallback(()=>{const a=z=>Math.max(56,Math.min(120,z));if(!t.fitToStepDuration||m.durationMs==null)return a(t.charIntervalMs);const g=j.reduce((z,H)=>z+H.length,0);if(g<=0)return a(t.charIntervalMs);const x=Math.max(0,j.length-1)*t.linePauseMs,f=Math.max(0,m.durationMs-x)/g;return a(f)},[m.durationMs,j,t.charIntervalMs,t.fitToStepDuration,t.linePauseMs]);return s.jsx("div",{className:W("w-full max-w-md mx-auto",G),...N,children:s.jsxs("div",{className:"p-2  flex items-center gap-2",children:[s.jsxs("div",{className:"shrink-0 relative",children:[s.jsx("div",{className:"absolute inset-0 -z-10 flex items-center justify-center pointer-events-none",children:s.jsx("div",{className:"absolute w-44 h-44 rounded-full bg-white/55 blur-3xl"})}),s.jsx(me,{motion:B,isBlink:l,width:S,height:K,className:"mx-auto"})]}),s.jsx("div",{className:"flex-1",children:s.jsx("div",{className:W("rounded-2xl border border-white/60 bg-white/70 backdrop-blur-md px-2 py-3"),children:s.jsx("div",{className:"text-sm md:text-base text-slate-700 leading-relaxed",children:E?s.jsx("p",{className:"font-semibold",children:j[0]??""}):s.jsx(ce,{className:"font-semibold",texts:j,speed:U(),delay:500,showCursor:t.showCursor,cursor:"▍",cursorClassName:"text-slate-500",loop:t.loop,pauseDuration:t.linePauseMs,startOnView:!1,once:!1},`${L}:${String(T??"")}`)})})})]})})});V.displayName="QuizMascotPrompt";V.__docgenInfo={description:"",methods:[],displayName:"QuizMascotPrompt",props:{active:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},script:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  motion: MascotMotionType
  /** Duration for this step in milliseconds. Use \`null\` for infinite duration (no auto-advance). */
  durationMs: number | null
  /** Text snippets that will loop continuously while the step is active. */
  lines: string[]
}`,signature:{properties:[{key:"motion",value:{name:"unknown[union]",raw:"(typeof MascotMotion)[keyof typeof MascotMotion]",required:!0}},{key:"durationMs",value:{name:"union",raw:"number | null",elements:[{name:"number"},{name:"null"}],required:!0},description:"Duration for this step in milliseconds. Use `null` for infinite duration (no auto-advance)."},{key:"lines",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!0},description:"Text snippets that will loop continuously while the step is active."}]}}],raw:"QuizMascotScriptStep[]"},description:"Primary script that runs when activated."},interruptScript:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  motion: MascotMotionType
  /** Duration for this step in milliseconds. Use \`null\` for infinite duration (no auto-advance). */
  durationMs: number | null
  /** Text snippets that will loop continuously while the step is active. */
  lines: string[]
}`,signature:{properties:[{key:"motion",value:{name:"unknown[union]",raw:"(typeof MascotMotion)[keyof typeof MascotMotion]",required:!0}},{key:"durationMs",value:{name:"union",raw:"number | null",elements:[{name:"number"},{name:"null"}],required:!0},description:"Duration for this step in milliseconds. Use `null` for infinite duration (no auto-advance)."},{key:"lines",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!0},description:"Text snippets that will loop continuously while the step is active."}]}}],raw:"QuizMascotScriptStep[]"},description:"Script that runs when `triggerKey` changes (interrupt + restart)."},triggerKey:{required:!1,tsType:{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]},description:"Change this value to immediately restart the script."},inactiveMotion:{required:!1,tsType:{name:"unknown[union]",raw:"(typeof MascotMotion)[keyof typeof MascotMotion]"},description:"",defaultValue:{value:"'IDLE'",computed:!1}},mascotWidth:{required:!1,tsType:{name:"union",raw:"number | string",elements:[{name:"number"},{name:"string"}]},description:"",defaultValue:{value:"140",computed:!1}},mascotHeight:{required:!1,tsType:{name:"union",raw:"number | string",elements:[{name:"number"},{name:"string"}]},description:"",defaultValue:{value:"140",computed:!1}},mascotBlink:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},stream:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** Base typing speed (ms per character) when \`fitToStepDuration\` is false or step is infinite. */
  charIntervalMs?: number
  /** Pause between lines (ms). */
  linePauseMs?: number
  /** Whether to loop through lines continuously while the step is active. */
  loop?: boolean
  /** Whether to show a blinking cursor while typing. */
  showCursor?: boolean
  /** When step has a finite duration, scale typing speed to fit within it. */
  fitToStepDuration?: boolean
}`,signature:{properties:[{key:"charIntervalMs",value:{name:"number",required:!1},description:"Base typing speed (ms per character) when `fitToStepDuration` is false or step is infinite."},{key:"linePauseMs",value:{name:"number",required:!1},description:"Pause between lines (ms)."},{key:"loop",value:{name:"boolean",required:!1},description:"Whether to loop through lines continuously while the step is active."},{key:"showCursor",value:{name:"boolean",required:!1},description:"Whether to show a blinking cursor while typing."},{key:"fitToStepDuration",value:{name:"boolean",required:!1},description:"When step has a finite duration, scale typing speed to fit within it."}]}},description:""},onStepChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(index: number) => void",signature:{arguments:[{type:{name:"number"},name:"index"}],return:{name:"void"}}},description:""},onMotionChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(motion: MascotMotionType) => void",signature:{arguments:[{type:{name:"unknown[union]",raw:"(typeof MascotMotion)[keyof typeof MascotMotion]"},name:"motion"}],return:{name:"void"}}},description:""}}};const Z=e.forwardRef(({className:G,questions:d,onClose:v,onQuizComplete:M,...T},k)=>{var F,_,O,$,Y,J;const[S,K]=e.useState(0),[l,i]=e.useState(null),[R,q]=e.useState({}),[N,D]=e.useState(!1),[I,L]=e.useState(0),[c,B]=e.useState(!1),[p,y]=e.useState(!1),[P,h]=e.useState(!1),[b,A]=e.useState(null),[m,E]=e.useState(!1),t=d==null?void 0:d[S];if(!t)return s.jsx("div",{className:"p-8 text-center text-slate-500",children:"No questions available."});const j=S===d.length-1,U=S/d.length*100;e.useEffect(()=>{y(!1),h(!1),A(null),E(!1)},[t.id]),e.useEffect(()=>{if(c){h(!1);return}if(!p){h(!1);return}const n=window.setTimeout(()=>{h(!0)},8e3);return()=>window.clearTimeout(n)},[p,c,t.id]);const o=e.useMemo(()=>[{motion:u.SPEAKING,durationMs:2800,lines:["Quick tip:","Look for jurisdiction, money limits, and timing."]},{motion:u.THINKING,durationMs:null,lines:["Eliminate obvious mismatches.","Then choose the best fit."]}],[]),w=e.useMemo(()=>[{motion:u.CELEBRATE,durationMs:2200,lines:["Nice!","That’s the right idea."]},{motion:u.SPEAKING,durationMs:2600,lines:["Keep going — one question at a time."]}],[]),a=e.useMemo(()=>[{motion:u.CONFUSED,durationMs:2400,lines:["Close — but not quite.","Let’s use the explanation to lock it in."]},{motion:u.SPEAKING,durationMs:2600,lines:["You’ll spot this pattern next time."]}],[]),g=e.useMemo(()=>{var n,r;return(r=(n=t.mascot)==null?void 0:n.script)!=null&&r.length?t.mascot.script:o},[(F=t.mascot)==null?void 0:F.script,o]),x=e.useMemo(()=>{var n,r;return(r=(n=t.mascot)==null?void 0:n.onRevealCorrect)!=null&&r.length?t.mascot.onRevealCorrect:w},[(_=t.mascot)==null?void 0:_.onRevealCorrect,w]),C=e.useMemo(()=>{var n,r;return(r=(n=t.mascot)==null?void 0:n.onRevealIncorrect)!=null&&r.length?t.mascot.onRevealIncorrect:a},[(O=t.mascot)==null?void 0:O.onRevealIncorrect,a]),f=c&&b!=null&&p&&!m;e.useEffect(()=>{if(!f)return;const r=(b?x:C).reduce((oe,ie)=>oe+(ie.durationMs??0),0),Q=window.setTimeout(()=>{E(!0)},Math.max(1200,r));return()=>window.clearTimeout(Q)},[f,b,x,C]);const z=n=>{N||i(n)},H=()=>{var r;if(!l)return;const n=!!((r=t.answers.find(Q=>Q.id===l))!=null&&r.correct);n&&L(Q=>Q+1),q(Q=>({...Q,[t.id]:l})),D(!0),B(!0),A(n)},ee=()=>{var n;j?M(I+((n=t.answers.find(r=>r.id===l))!=null&&n.correct&&!N?1:0),d.length,R):(K(r=>r+1),i(null),D(!1),B(!1),y(!1),A(null),E(!1))},te=e.useMemo(()=>f?!0:c?!1:p&&P,[P,p,f,c]),ne=e.useMemo(()=>f?b?x:C:g,[x,g,C,b,f]),se=e.useMemo(()=>{var r;return{...((r=t.mascot)==null?void 0:r.stream)??{},loop:!f}},[($=t.mascot)==null?void 0:$.stream,f]),re=e.useMemo(()=>c?u.IDLE:p?u.IDLE:u.WRITING,[p,c]);return s.jsxs("div",{ref:k,className:W("flex flex-col h-full min-h-screen relative overflow-hidden","bg-gradient-to-br from-sky-100 via-blue-50 to-white",G),...T,children:[s.jsx("div",{className:"absolute top-[-10%] right-[-10%] w-[600px] h-[600px] bg-sky-200/40 rounded-full blur-3xl pointer-events-none animate-pulse"}),s.jsx("div",{className:"absolute bottom-[-10%] left-[-10%] w-[500px] h-[500px] bg-blue-200/40 rounded-full blur-3xl pointer-events-none animate-pulse delay-700"}),s.jsx(ae,{onClose:v,currentQuestion:S+1,totalQuestions:d.length,progress:U,className:"bg-white/40 backdrop-blur-md border-white/20 sticky top-0 z-10"}),s.jsx("div",{className:"flex-1 overflow-y-auto px-5 py-8 pb-32 relative z-0",children:s.jsxs("div",{className:"max-w-2xl mx-auto",children:[s.jsx(ue,{question:t.question,questionNumber:S+1,typingKey:t.id,typingSpeedMs:70,showCursor:((Y=t.typing)==null?void 0:Y.showCursor)??!1,onTypedComplete:()=>y(!0),className:"mb-8"}),s.jsx(V,{className:"mb-6",active:te,script:ne,stream:se,inactiveMotion:re,mascotWidth:240,mascotHeight:240}),s.jsx("div",{className:"space-y-3 animate-slide-in-from-bottom",children:t.answers.map((n,r)=>s.jsx(de,{selected:l===n.id,correct:N&&n.correct,incorrect:N&&l===n.id&&!n.correct,onClick:()=>z(n.id),disabled:N,shortcut:String.fromCharCode(65+r),className:"animate-fade-in bg-white/60 backdrop-blur-sm border-white/40 hover:bg-white/80",children:n.text},n.id))})]})}),!c&&s.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-5 bg-white/30 backdrop-blur-xl border-t border-white/20 z-10",children:s.jsx("div",{className:"max-w-2xl mx-auto",children:s.jsx(pe,{onClick:H,disabled:!l,className:W("w-full font-bold py-6 text-lg rounded-2xl shadow-xl transition-all duration-300",l?"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-500/30 hover:-translate-y-1 hover:shadow-2xl":"bg-slate-200 text-slate-400 cursor-not-allowed"),children:"Check Answer"})})}),s.jsx(le,{show:c,correct:((J=t.answers.find(n=>n.id===l))==null?void 0:J.correct)||!1,explanation:t.explanation,onContinue:ee,className:"backdrop-blur-xl bg-white/80 border-t border-white/40"})]})});Z.displayName="QuizScreen";Z.__docgenInfo={description:"",methods:[],displayName:"QuizScreen",props:{questions:{required:!0,tsType:{name:"Array",elements:[{name:"Question"}],raw:"Question[]"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onQuizComplete:{required:!0,tsType:{name:"signature",type:"function",raw:"(score: number, total: number, userAnswers: Record<string | number, string | number>) => void",signature:{arguments:[{type:{name:"number"},name:"score"},{type:{name:"number"},name:"total"},{type:{name:"Record",elements:[{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]},{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]}],raw:"Record<string | number, string | number>"},name:"userAnswers"}],return:{name:"void"}}},description:""}}};export{Z as Q};
