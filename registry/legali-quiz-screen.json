{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "legali-quiz-screen",
  "type": "registry:ui",
  "files": [
    {
      "path": "components/ui/legali/screens/QuizScreen.tsx",
      "content": "import * as React from \"react\";\nimport { Button } from \"@/components/ui/legali/button\";\nimport { cn } from \"@/lib/utils\";\nimport { Answer } from \"../atomic/Answer\";\nimport { QuizFeedback } from \"../composite/QuizFeedback\";\nimport { QuizHeader } from \"../composite/QuizHeader\";\nimport {\n  QuizMascotPrompt,\n  type QuizMascotScriptStep,\n  type QuizMascotStreamConfig,\n} from \"../composite/QuizMascotPrompt\";\nimport { QuizQuestion } from \"../composite/QuizQuestion\";\nimport { MascotMotion } from \"../mascot\";\n\nexport interface AnswerOption {\n  id: string | number;\n  text: string;\n  correct: boolean;\n}\n\nexport interface Question {\n  id: string | number;\n  question: string;\n  answers: AnswerOption[];\n  explanation: string;\n\n  typing?: {\n    /** Typing speed for the question (ms per character). */\n    speedMs?: number;\n    /** Whether to show the cursor while typing the question. */\n    showCursor?: boolean;\n  };\n\n  mascot?: {\n    /** Looping script that runs while the question is typing (pre-hint, pre-feedback). */\n    onReading?: QuizMascotScriptStep[];\n    /** Looping script that runs after the question finishes typing (until feedback). */\n    script?: QuizMascotScriptStep[];\n    /** One-shot script to run (after question typing) when the answer is correct. */\n    onRevealCorrect?: QuizMascotScriptStep[];\n    /** One-shot script to run (after question typing) when the answer is incorrect. */\n    onRevealIncorrect?: QuizMascotScriptStep[];\n    /** TypingText behavior for mascot lines. */\n    stream?: QuizMascotStreamConfig;\n  };\n}\n\nexport interface QuizScreenProps extends React.HTMLAttributes<HTMLDivElement> {\n  questions: Question[];\n  onClose: () => void;\n  onQuizComplete: (\n    score: number,\n    total: number,\n    userAnswers: Record<string | number, string | number>\n  ) => void;\n}\n\nconst QuizScreen = React.forwardRef<HTMLDivElement, QuizScreenProps>(\n  ({ className, questions, onClose, onQuizComplete, ...props }, ref) => {\n    const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);\n    const [selectedAnswerId, setSelectedAnswerId] = React.useState<string | number | null>(null);\n    const [userAnswers, setUserAnswers] = React.useState<Record<string | number, string | number>>(\n      {}\n    );\n    const [isAnswerChecked, setIsAnswerChecked] = React.useState(false);\n    const [score, setScore] = React.useState(0);\n    const [showFeedback, setShowFeedback] = React.useState(false);\n\n    const [questionTypedDone, setQuestionTypedDone] = React.useState(false);\n    const [promptDelayDone, setPromptDelayDone] = React.useState(false);\n    const [pendingResult, setPendingResult] = React.useState<boolean | null>(null);\n    const [reactionPlayed, setReactionPlayed] = React.useState(false);\n\n    const currentQuestion = questions?.[currentQuestionIndex];\n\n    if (!currentQuestion) {\n      return <div className=\"p-8 text-center text-slate-500\">No questions available.</div>;\n    }\n\n    const isLastQuestion = currentQuestionIndex === questions.length - 1;\n    const progress = (currentQuestionIndex / questions.length) * 100;\n\n    React.useEffect(() => {\n      setQuestionTypedDone(false);\n      setPromptDelayDone(false);\n      setPendingResult(null);\n      setReactionPlayed(false);\n    }, [currentQuestion.id]);\n\n    React.useEffect(() => {\n      if (showFeedback) {\n        setPromptDelayDone(false);\n        return;\n      }\n\n      if (!questionTypedDone) {\n        setPromptDelayDone(false);\n        return;\n      }\n\n      const timer = window.setTimeout(() => {\n        setPromptDelayDone(true);\n      }, 8000);\n\n      return () => window.clearTimeout(timer);\n    }, [questionTypedDone, showFeedback, currentQuestion.id]);\n\n    const defaultHintScript = React.useMemo<QuizMascotScriptStep[]>(\n      () => [\n        {\n          motion: MascotMotion.SPEAKING,\n          durationMs: 2800,\n          lines: [\"Quick tip:\", \"Look for jurisdiction, money limits, and timing.\"],\n        },\n        {\n          motion: MascotMotion.THINKING,\n          durationMs: null,\n          lines: [\"Eliminate obvious mismatches.\", \"Then choose the best fit.\"],\n        },\n      ],\n      []\n    );\n\n    const defaultReadingScript = React.useMemo<QuizMascotScriptStep[]>(\n      () => [\n        {\n          motion: MascotMotion.SPEAKING,\n          durationMs: 2600,\n          lines: [\"Let’s read this carefully.\", \"Focus on the key detail.\"],\n        },\n        {\n          motion: MascotMotion.SPEAKING,\n          durationMs: null,\n          lines: [\"Take your time.\", \"Then choose the best answer.\"],\n        },\n      ],\n      []\n    );\n\n    const defaultCorrectScript = React.useMemo<QuizMascotScriptStep[]>(\n      () => [\n        {\n          motion: MascotMotion.CELEBRATE,\n          durationMs: 2200,\n          lines: [\"Nice!\", \"That’s the right idea.\"],\n        },\n        {\n          motion: MascotMotion.SPEAKING,\n          durationMs: 2600,\n          lines: [\"Keep going — one question at a time.\"],\n        },\n      ],\n      []\n    );\n\n    const defaultIncorrectScript = React.useMemo<QuizMascotScriptStep[]>(\n      () => [\n        {\n          motion: MascotMotion.CONFUSED,\n          durationMs: 2400,\n          lines: [\"Close — but not quite.\", \"Let’s use the explanation to lock it in.\"],\n        },\n        {\n          motion: MascotMotion.SPEAKING,\n          durationMs: 2600,\n          lines: [\"You’ll spot this pattern next time.\"],\n        },\n      ],\n      []\n    );\n\n    const hintScript = React.useMemo(\n      () =>\n        currentQuestion.mascot?.script?.length ? currentQuestion.mascot.script : defaultHintScript,\n      [currentQuestion.mascot?.script, defaultHintScript]\n    );\n\n    const readingScript = React.useMemo(\n      () =>\n        currentQuestion.mascot?.onReading?.length\n          ? currentQuestion.mascot.onReading\n          : defaultReadingScript,\n      [currentQuestion.mascot?.onReading, defaultReadingScript]\n    );\n\n    const correctScript = React.useMemo(\n      () =>\n        currentQuestion.mascot?.onRevealCorrect?.length\n          ? currentQuestion.mascot.onRevealCorrect\n          : defaultCorrectScript,\n      [currentQuestion.mascot?.onRevealCorrect, defaultCorrectScript]\n    );\n\n    const incorrectScript = React.useMemo(\n      () =>\n        currentQuestion.mascot?.onRevealIncorrect?.length\n          ? currentQuestion.mascot.onRevealIncorrect\n          : defaultIncorrectScript,\n      [currentQuestion.mascot?.onRevealIncorrect, defaultIncorrectScript]\n    );\n\n    const shouldPlayReaction =\n      showFeedback && pendingResult != null && questionTypedDone && !reactionPlayed;\n\n    React.useEffect(() => {\n      if (!shouldPlayReaction) return;\n\n      const steps = pendingResult ? correctScript : incorrectScript;\n      const totalMs = steps.reduce((sum, s) => sum + (s.durationMs ?? 0), 0);\n      const timer = window.setTimeout(\n        () => {\n          setReactionPlayed(true);\n        },\n        Math.max(1200, totalMs)\n      );\n\n      return () => window.clearTimeout(timer);\n    }, [shouldPlayReaction, pendingResult, correctScript, incorrectScript]);\n\n    const handleAnswerSelect = (id: string | number) => {\n      if (isAnswerChecked) return;\n      setSelectedAnswerId(id);\n    };\n\n    const handleCheck = () => {\n      if (!selectedAnswerId) return;\n\n      const isCorrect = Boolean(\n        currentQuestion.answers.find((a) => a.id === selectedAnswerId)?.correct\n      );\n      if (isCorrect) setScore((s) => s + 1);\n\n      setUserAnswers((prev) => ({\n        ...prev,\n        [currentQuestion.id]: selectedAnswerId,\n      }));\n\n      setIsAnswerChecked(true);\n      setShowFeedback(true);\n\n      setPendingResult(isCorrect);\n    };\n\n    const handleContinue = () => {\n      if (isLastQuestion) {\n        onQuizComplete(\n          score +\n            (currentQuestion.answers.find((a) => a.id === selectedAnswerId)?.correct &&\n            !isAnswerChecked\n              ? 1\n              : 0), // Handle case where check wasn't clicked if that's possible (though UI prevents it) - actually logic above sets score on check.\n          questions.length,\n          userAnswers\n        );\n      } else {\n        setCurrentQuestionIndex((i) => i + 1);\n        setSelectedAnswerId(null);\n        setIsAnswerChecked(false);\n        setShowFeedback(false);\n\n        setQuestionTypedDone(false);\n        setPendingResult(null);\n        setReactionPlayed(false);\n      }\n    };\n\n    const promptActive = React.useMemo(() => {\n      if (showFeedback && pendingResult != null) return true;\n      if (showFeedback) return false;\n      return true;\n    }, [pendingResult, showFeedback]);\n\n    const promptTriggerKey = React.useMemo(() => {\n      const resultKey = pendingResult == null ? \"none\" : pendingResult ? \"correct\" : \"incorrect\";\n      const phaseKey = showFeedback ? \"feedback\" : promptDelayDone ? \"hint\" : \"reading\";\n      return `${String(currentQuestion.id)}:${phaseKey}:${resultKey}`;\n    }, [currentQuestion.id, pendingResult, promptDelayDone, showFeedback]);\n\n    const promptScript = React.useMemo<QuizMascotScriptStep[]>(() => {\n      if (shouldPlayReaction) return pendingResult ? correctScript : incorrectScript;\n      if (showFeedback && pendingResult != null)\n        return pendingResult ? correctScript : incorrectScript;\n      if (!promptDelayDone) return readingScript;\n      return hintScript;\n    }, [\n      correctScript,\n      hintScript,\n      incorrectScript,\n      pendingResult,\n      promptDelayDone,\n      readingScript,\n      shouldPlayReaction,\n      showFeedback,\n    ]);\n\n    const promptStream = React.useMemo<QuizMascotStreamConfig>(() => {\n      const base = currentQuestion.mascot?.stream ?? {};\n      return {\n        ...base,\n        loop: shouldPlayReaction ? false : true,\n      };\n    }, [currentQuestion.mascot?.stream, shouldPlayReaction]);\n\n    const inactiveMotion = React.useMemo(() => {\n      if (showFeedback) {\n        if (pendingResult === true) return MascotMotion.CELEBRATE;\n        return MascotMotion.IDLE;\n      }\n      return questionTypedDone ? MascotMotion.IDLE : MascotMotion.WRITING;\n    }, [pendingResult, questionTypedDone, showFeedback]);\n\n    return (\n      <div\n        className={cn(\n          \"relative flex h-full min-h-screen flex-col overflow-hidden\",\n          // New Bluish Gradient Background\n          \"bg-gradient-to-br from-sky-100 via-blue-50 to-white\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      >\n        {/* Decorative Orbs */}\n        <div className=\"pointer-events-none absolute top-[-10%] right-[-10%] h-[600px] w-[600px] animate-pulse rounded-full bg-sky-200/40 blur-3xl\" />\n        <div className=\"pointer-events-none absolute bottom-[-10%] left-[-10%] h-[500px] w-[500px] animate-pulse rounded-full bg-blue-200/40 blur-3xl delay-700\" />\n\n        <QuizHeader\n          className=\"sticky top-0 z-10 border-white/20 bg-white/40 backdrop-blur-md\"\n          currentQuestion={currentQuestionIndex + 1}\n          onClose={onClose}\n          progress={progress}\n          totalQuestions={questions.length}\n        />\n\n        <div className=\"relative z-0 flex-1 overflow-y-auto px-5 py-8 pb-32\">\n          <div className=\"mx-auto max-w-2xl\">\n            <QuizQuestion\n              className=\"mb-8\"\n              onTypedComplete={() => setQuestionTypedDone(true)}\n              question={currentQuestion.question}\n              questionNumber={currentQuestionIndex + 1}\n              showCursor={currentQuestion.typing?.showCursor ?? false}\n              typingKey={currentQuestion.id}\n              typingSpeedMs={70}\n            />\n            <QuizMascotPrompt\n              active={promptActive}\n              className=\"mb-6\"\n              inactiveMotion={inactiveMotion}\n              mascotHeight={240}\n              mascotWidth={240}\n              script={promptScript}\n              stream={promptStream}\n              triggerKey={promptTriggerKey}\n            />\n\n            <div className=\"animate-slide-in-from-bottom space-y-3\">\n              {currentQuestion.answers.map((answer, index) => (\n                <Answer\n                  className=\"animate-fade-in border-white/40 bg-white/60 backdrop-blur-sm hover:bg-white/80\"\n                  correct={isAnswerChecked && answer.correct}\n                  disabled={isAnswerChecked}\n                  incorrect={isAnswerChecked && selectedAnswerId === answer.id && !answer.correct}\n                  key={answer.id}\n                  onClick={() => handleAnswerSelect(answer.id)}\n                  selected={selectedAnswerId === answer.id} // A, B, C, D\n                  shortcut={String.fromCharCode(65 + index)}\n                >\n                  {answer.text}\n                </Answer>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* Bottom Action Bar */}\n        {!showFeedback && (\n          <div className=\"fixed right-0 bottom-0 left-0 z-10 border-white/20 border-t bg-white/30 p-5 backdrop-blur-xl\">\n            <div className=\"mx-auto max-w-2xl\">\n              <Button\n                className={cn(\n                  \"w-full rounded-2xl py-6 font-bold text-lg shadow-xl transition-all duration-300\",\n                  selectedAnswerId\n                    ? \"bg-blue-600 text-white shadow-blue-500/30 hover:-translate-y-1 hover:bg-blue-700 hover:shadow-2xl\"\n                    : \"cursor-not-allowed bg-slate-200 text-slate-400\"\n                )}\n                disabled={!selectedAnswerId}\n                onClick={handleCheck}\n              >\n                Check Answer\n              </Button>\n            </div>\n          </div>\n        )}\n\n        <QuizFeedback\n          className=\"border-white/40 border-t bg-white/80 backdrop-blur-xl\"\n          correct={currentQuestion.answers.find((a) => a.id === selectedAnswerId)?.correct ?? false}\n          explanation={currentQuestion.explanation}\n          onContinue={handleContinue}\n          show={showFeedback}\n        />\n      </div>\n    );\n  }\n);\nQuizScreen.displayName = \"QuizScreen\";\n\nexport { QuizScreen };\n",
      "type": "registry:ui"
    }
  ],
  "dependencies": [
    "clsx",
    "tailwind-merge"
  ],
  "registryDependencies": [
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-quiz-header.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-quiz-question.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-quiz-feedback.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-answer.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-button.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-lib-utils.json"
  ]
}