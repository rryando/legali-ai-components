{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "legali-intake-chat-panel",
  "type": "registry:ui",
  "files": [
    {
      "path": "components/ui/legali/composite/IntakeChatPanel.tsx",
      "content": "/**\n * @see {@link https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-intake-chat-panel.json} â€” Install:\n * @example npx shadcn@latest add \"https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-intake-chat-panel.json\"\n */\nimport { forwardRef, useCallback, useEffect, useRef, useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { ChatInput } from \"../atomic/ChatInput\";\nimport { SuggestionChip } from \"../atomic/SuggestionChip\";\nimport type { ChatMessage, ContactInfo, IntakeChatScriptStep } from \"../data/marketplace-types\";\nimport { LegaliMascot, MascotMotion, type MascotMotionType } from \"../mascot\";\nimport { ChatWindow } from \"./ChatWindow\";\nimport { ContactInfoForm } from \"./ContactInfoForm\";\n\ntype IntakeChatPanelProps = {\n  script: IntakeChatScriptStep[];\n  onComplete?: (messages: ChatMessage[], contactInfo: ContactInfo | null) => void;\n  className?: string;\n};\n\nfunction createMessage(sender: ChatMessage[\"sender\"], text: string, id?: string): ChatMessage {\n  return {\n    id: id ?? `msg-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,\n    sender,\n    text,\n    timestamp: new Date(),\n  };\n}\n\nconst IntakeChatPanel = forwardRef<HTMLDivElement, IntakeChatPanelProps>(\n  ({ className, script, onComplete }, ref) => {\n    const [messages, setMessages] = useState<ChatMessage[]>([]);\n    const [scriptIndex, setScriptIndex] = useState(0);\n    const [isAiTyping, setIsAiTyping] = useState(false);\n    const [showContactForm, setShowContactForm] = useState(false);\n    const [contactInfo, setContactInfo] = useState<ContactInfo | null>(null);\n    const [suggestions, setSuggestions] = useState<string[]>([]);\n    const [mascotMotion, setMascotMotion] = useState<MascotMotionType>(MascotMotion.WAVING);\n    const [inputDisabled, setInputDisabled] = useState(true);\n    const completedRef = useRef(false);\n\n    // Fire the current script step (AI message)\n    const fireStep = useCallback(\n      (index: number) => {\n        if (index >= script.length) return;\n        const step = script[index];\n        setIsAiTyping(true);\n        setInputDisabled(true);\n        setSuggestions([]);\n        if (step.mascotMotion) setMascotMotion(step.mascotMotion);\n\n        const delay = step.delayMs ?? 1200;\n        const timer = setTimeout(() => {\n          setMessages((prev) => [...prev, createMessage(\"ai\", step.aiMessage)]);\n          setIsAiTyping(false);\n\n          if (step.showContactForm) {\n            setShowContactForm(true);\n            setInputDisabled(true);\n          } else {\n            setInputDisabled(false);\n          }\n\n          if (step.suggestions) {\n            setSuggestions(step.suggestions);\n          }\n        }, delay);\n\n        return () => clearTimeout(timer);\n      },\n      [script]\n    );\n\n    // Initial greeting\n    useEffect(() => {\n      return fireStep(0);\n    }, [fireStep]);\n\n    const advanceScript = useCallback(() => {\n      const nextIndex = scriptIndex + 1;\n      if (nextIndex >= script.length) {\n        if (!completedRef.current) {\n          completedRef.current = true;\n          onComplete?.(messages, contactInfo);\n        }\n        return;\n      }\n      setScriptIndex(nextIndex);\n      fireStep(nextIndex);\n    }, [scriptIndex, script.length, fireStep, onComplete, messages, contactInfo]);\n\n    const handleUserMessage = useCallback(\n      (text: string) => {\n        setMessages((prev) => [...prev, createMessage(\"user\", text)]);\n        setSuggestions([]);\n        // Small delay before advancing\n        setTimeout(advanceScript, 300);\n      },\n      [advanceScript]\n    );\n\n    const handleSuggestionClick = useCallback(\n      (text: string) => {\n        handleUserMessage(text);\n      },\n      [handleUserMessage]\n    );\n\n    const handleContactSubmit = useCallback(\n      (info: ContactInfo) => {\n        setContactInfo(info);\n        setShowContactForm(false);\n        setMessages((prev) => [\n          ...prev,\n          createMessage(\"system\", `Contact details submitted: ${info.firstName} ${info.lastName}`),\n        ]);\n        setTimeout(advanceScript, 300);\n      },\n      [advanceScript]\n    );\n\n    return (\n      <div\n        className={cn(\n          \"flex h-[600px] flex-col overflow-hidden rounded-2xl border border-slate-200/50 bg-gradient-to-b from-slate-50/80 to-white/60 backdrop-blur-xl\",\n          className\n        )}\n        ref={ref}\n      >\n        {/* Header */}\n        <div className=\"flex items-center gap-3 border-slate-200/40 border-b px-4 py-3\">\n          <div className=\"h-10 w-10\">\n            <LegaliMascot height={40} motion={mascotMotion} width={40} />\n          </div>\n          <div>\n            <p className=\"font-semibold text-slate-800 text-sm\">Legali AI Assistant</p>\n            <p className=\"text-slate-400 text-xs\">Your legal advisor</p>\n          </div>\n        </div>\n\n        {/* Chat area */}\n        <ChatWindow isTyping={isAiTyping} messages={messages} />\n\n        {/* Contact form (slides in when needed) */}\n        {showContactForm && <ContactInfoForm onSubmit={handleContactSubmit} />}\n\n        {/* Suggestions */}\n        {suggestions.length > 0 && (\n          <div className=\"flex flex-wrap gap-2 border-slate-200/40 border-t px-4 py-2\">\n            {suggestions.map((s, i) => (\n              <SuggestionChip\n                animationDelay={i * 0.1}\n                key={s}\n                label={s}\n                onClick={() => handleSuggestionClick(s)}\n              />\n            ))}\n          </div>\n        )}\n\n        {/* Input */}\n        <div className=\"border-slate-200/40 border-t p-3\">\n          <ChatInput disabled={inputDisabled || isAiTyping} onSend={handleUserMessage} />\n        </div>\n      </div>\n    );\n  }\n);\n\nIntakeChatPanel.displayName = \"IntakeChatPanel\";\n\nexport { IntakeChatPanel };\nexport type { IntakeChatPanelProps };\n",
      "type": "registry:ui"
    }
  ],
  "registryDependencies": [
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-lib-utils.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-chat-input.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-suggestion-chip.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-chat-window.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-contact-info-form.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-mascot.json",
    "https://raw.githubusercontent.com/rryando/legali-ai-components/main/registry/legali-marketplace-types.json"
  ]
<<<<<<< Updated upstream
}
=======
}
>>>>>>> Stashed changes
